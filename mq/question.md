
### 消息系统的应用

```
1.解耦 2. 冗余，数据安全 3.扩展性（新的消费者） 4. 灵活性，峰值处理能力； 5.跨系统通信 6.异步 7.缓冲
```

### kafka会不会丢消息

```
kafka是会丢消息的，可发生在Producer，Broker，Consumer

Broker
Broker丢失消息是由于Kafka本身的原因造成的，kafka为了得到更高的性能和吞吐量，将数据异步批量的存储在磁盘中。消息的刷盘过程，为了提高性能，减少刷盘次数，kafka采用了批量刷盘的做法。即，按照一定的消息量，和时间间隔进行刷盘。这种机制也是由于linux操作系统决定的。将数据存储到linux操作系统种，会先存储到页缓存（Page cache）中，按照时间或者其他条件进行刷盘（从page cache到file），或者通过fsync命令强制刷盘。数据在page cache中时，如果系统挂掉，数据会丢失。

Producer
为了提升效率，减少IO，producer在发送数据时可以将多个请求进行合并后发送。被合并的请求咋发送一线缓存在本地buffer中。缓存的方式和前文提到的刷盘类似，producer可以将请求打包成“块”或者按照时间间隔，将buffer中的数据发出。通过buffer我们可以将生产者改造为异步的方式，而这可以提升我们的发送效率。Buffer中待发送的数据是有丢失风险的。

Consumer

Consumer的消费方式主要分为两种：
自动提交offset，Automatic Offset Committing
手动提交offset，Manual Offset Control

Consumer自动提交的机制是根据一定的时间间隔，将收到的消息进行commit。commit过程和消费消息的过程是异步的。也就是说，可能存在消费过程未成功（比如抛出异常），commit消息已经提交了。此时消息就丢失了。

```


### Kafka 的每个分区只能被一个消费者线程，如何做到多个线程同时消费一个分区？

```
官方并没有支持

只能开发者自己讲消费进程再拆成拉取线程和工作线程。搞多个工作线程
```

### 数据传输的事务有几种

```
（1）最多一次: 消息不会被重复发送，最多被传输一次，但也有可能一次不传输
（2）最少一次: 消息不会被漏发送，最少被传输一次，但也有可能被重复传输.
（3）精确的一次（Exactly once）: 不会漏传输也不会重复传输,每个消息都传输被
```